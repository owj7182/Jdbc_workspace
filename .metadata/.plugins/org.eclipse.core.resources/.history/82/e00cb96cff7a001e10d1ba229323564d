package com.sh.tb_user.view;

import java.sql.Date;
import java.text.SimpleDateFormat;
import java.util.List;
import java.util.Scanner;

import com.sh.tb_user.controller.Tb_userController;
import com.sh.tb_user.model.entity.Tb_user;

public class Tb_userMenu {
	private Scanner sc = new Scanner(System.in);
	private Tb_userController userController = new Tb_userController();

	public void mainMenu() {
		String menu = """
					===========================
					   ë¶ ì¹´í˜ ì–´í”Œ ì‹œì‘ í˜ì´ì§€
					===========================
					1. ë¡œê·¸ì¸
					2. íšŒì› ê°€ì…
					3. í”„ë¡œê·¸ë¨ ì•ˆë‚´
					0. ì¢…ë£Œ
					===========================
					ì„ íƒ : """;
		while(true) {
			System.out.println();
			System.out.print(menu);
			String choice = sc.next();
			
			Tb_user user = null;
			int result = 0;
			String id = null;
			
			switch (choice) {
			case "1": break;
			case "2": 
				user = inputUser();
				result = userController.insertUser(user);
				displayResult("íšŒì›ê°€ì…", result);
				break;
//			case "3": 
//				updateMenu();
//				break;
//			case "4": 
//				id = inputId();
//				result = userController.deleteUser(id);
//				displayResult("íšŒì›íƒˆí‡´", result);
//				break;
			case "3": break;
			case "0": return;

			default:
				System.out.println("ì˜ëª» ì…ë ¥í•˜ì…¨ìŠµë‹ˆë‹¤.");
				break;
			}
		}
	}

	private void updateMenu() {
		String menu = """
				+++++++++ íšŒì› ì •ë³´ìˆ˜ì • +++++++++
				1. ì´ë¦„ ìˆ˜ì •
				2. ìƒì¼ ìˆ˜ì •
				3. í•¸ë“œí° ë²ˆí˜¸ ìˆ˜ì •
				4. ì´ë©”ì¼ ìˆ˜ì •
				5. ì¢‹ì•„í•˜ëŠ” ì¥ë¥´ ìˆ˜ì •
				0. ë©”ì¸ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
				++++++++++++++++++++++++++++++
				ì„ íƒ : """;
		String id = inputId();
		List<Tb_user> users = null;
		
		while(true) {
			users = userController.findById(id);
			displayUsers(users);
			if (users == null) 
				return;
			System.out.print(menu);
			String choice = sc.next();
			int result = 0;
			
			switch(choice) {
			case "1": 
				System.out.print("ë³€ê²½í•  ì´ë¦„ : ");
				String newName = sc.next();
				result = userController.updateUserName(id, newName);
				System.out.println("íšŒì›ëª… ìˆ˜ì • ì™„ë£Œ!");
				break;
			case "2": 
				System.out.print("ë³€ê²½í•  ìƒì¼ (ex 1998-03-23) : ");
				Date newBirthday = Date.valueOf(sc.next());
				result = userController.updateUserBirthday(id, newBirthday);
				System.out.println("ìƒì¼ ìˆ˜ì • ì™„ë£Œ!");
				break;
			case "3":
				System.out.print("ë³€ê²½í•  ë²ˆí˜¸ (ex 010-1234-5678) : ");
				String newPhone = sc.next();
				result = userController.updateUserPhone(id, newPhone);
				System.out.println("ë²ˆí˜¸ ìˆ˜ì • ì™„ë£Œ!");
				break;
			case "4": 
				System.out.print("ë³€ê²½í•  ì´ë©”ì¼ : ");
				String newEmail = sc.next();
				result = userController.updateUserEmail(id, newEmail);
				System.out.println("ì´ë©”ì¼ ìˆ˜ì • ì™„ë£Œ!");
				break;
			case "5":
				System.out.println("ë³€ê²½í•˜ê³  ì‹¶ì€ ì¢‹ì•„í•˜ëŠ” ì¥ë¥´ : ");
				String newFavoriteGenre = sc.next();
				result = userController.updateUserFavoriteGenre(id, newFavoriteGenre);
				System.out.println("ì¢‹ì•„í•˜ëŠ” ì¥ë¥´ ìˆ˜ì • ì™„ë£Œ!");
				break;
			case "0": return;
			default: System.out.println("> ì˜ëª»ì…ë ¥í•˜ì…¨ìŠµë‹ˆë‹¤.");
			
			}
			
		}
		
	}
		
	private String inputId() {
		System.out.print("> ì•„ì´ë”” ì…ë ¥ : ");
		return sc.next();
	}

	private Tb_user inputUser() {
		Tb_user user = new Tb_user();
		System.out.println("> íšŒì›ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        for (;;) {
            System.out.print("> ì•„ì´ë”” : ");
            user.setId(sc.next());
            if (userController.findById(user.getId()).isEmpty()) {
                System.out.println("> ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤ :)");
                break;
            } else {
                System.out.println("> ì‚¬ìš©ë¶ˆê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.");
                continue;
            }
        }
        System.out.print("> ë¹„ë°€ë²ˆí˜¸ : ");
        user.setPassword(sc.next());
        System.out.print("> ì´ë¦„ : ");
		user.setName(sc.next());
		System.out.print("> ì„±ë³„(M/F) : ");
		user.setGender(sc.next());
		System.out.print("> ìƒì¼(ex 1998-03-23) : ");
		user.setBirthday(Date.valueOf(sc.next()));
		System.out.print("> í•¸ë“œí° ë²ˆí˜¸(ex 010-1234-5678) : ");
		user.setPhone(sc.next());
		System.out.print("> ì´ë©”ì¼ : ");
		user.setEmail(sc.next());
		System.out.print("> ì¢‹ì•„í•˜ëŠ” ì¥ë¥´ : ");
		user.setFavoriteGenre(sc.next());
		return user;
	}
	

	/**
     * nê±´ì˜ íšŒì›ì¡°íšŒ ê²°ê³¼ë¥¼ ì¶œë ¥
     * @param members
     */
    private void displayUsers(List<Tb_user> users) {
        System.out.println("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------");
        System.out.printf("%-10s%-10s%-10s%-10s%-20s%-20s%-20s%-20s%-10s%-10s%-10s%-10s\n", 
                "ID","Password", "Name", "Gender", "Birthday", "Phone","Email", "CreatedAt", "Balance","Point","IsManager","FavoriteGenre" );
        System.out.println("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------");
        if(users == null || users.isEmpty()) {
            System.out.println("\t\t ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
        }
        else {
            for(Tb_user user : users) {
                System.out.printf("%-10s%-10s%-10s%-10s%-20s%-20s%-20s%-20s%-10s%-10s%-10s%-10s\n", 
                        user.getId(),
                        user.getPassword(),
                        user.getName(), 
                        user.getGender(), 
                        user.getBirthday(),
                        user.getPhone(),
                        user.getEmail(),
                        new SimpleDateFormat("yyyy-MM-dd HH:mm").format(user.getCreatedAt()),
                        user.getBalance(),
                        user.getPoint(),
                        user.getIsManager(),
                        user.getFavoriteGenre());
             
            }
        }
        System.out.println("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------");
    }
    

	/**
     * DML ì²˜ë¦¬ê²°ê³¼ ë©”ì†Œë“œ
     */
    private void displayResult(String type, int result) {
        if(result > 0)
            System.out.println("ğŸ‰ğŸ‰ " + type + " ì„±ê³µ! ğŸ‰ğŸ‰");
        else
            System.out.println("ğŸ˜­ğŸ˜­ " + type + " ì‹¤íŒ¨! ğŸ˜­ğŸ˜­");  
    }
    

}
